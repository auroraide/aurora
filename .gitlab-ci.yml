image: ubuntu:xenial

before_script:
    - apt-get update && apt-get install -y build-essential openjdk-8-jdk ant wget curl unzip git
    - wget -q https://storage.googleapis.com/gwt-releases/gwt-2.8.2.zip && unzip -qq -o -d .. gwt-2.8.2.zip
    - (cd vendor && wget -q https://builds.apache.org/job/Ivy/lastStableBuild/artifact/build/artifact/jars/ivy.jar)

stages:
    - test
    - deploy

testjob:
    stage: test
    script:
        - ant test -lib vendor

deployjob:
    stage: deploy
    only:
        - master
    script:
        - git rev-parse --short HEAD > war/VERSION
        - ant war -lib vendor
        - curl -F 'war=@aurora.war' "https://aurora.younishd.fr:8080?key=$DEPLOY_KEY"
